{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English's Cool - Hangman</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
    html, body {
    height: 100%;
}
body {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

main {
    flex: 1 0 auto;
}

.letter{
    font-size:2rem; 
    letter-spacing:0.5em;
}

.title{
    font-size: 3rem;
    font-weight: bold; 
}

button { 
    margin: 10px; 
    padding: 10px; 
    font-size: 16px; 
}

img.img-card { 
    max-width: 400px; 
    width: 100%;
    display: block; 
    margin: 20px auto 0 auto; 
}

.make-sentence { 
    font-size: 3.2rem; 
    font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif; 
    font-weight: 500; 
    color: #222; 
    text-align: center; 
}

@media screen and (max-width: 450px){
    .make-sentence {
        font-size: 2.5rem;
    }
}

@media (max-width: 450px){
    .letter{
        font-size:1.7rem; 
        letter-spacing:0.2em;
    }
    .title{
        font-size: 2.5rem;
    }
}

#hangmanCanvas {
    border: 2px solid #000;
    background-color: #f8f9fa;
    max-width: 100%;
    height: auto;
    }
</style>
</head>
<body style="background-color: #e3f2fd;">
    {% include "game/navbar.html" %}
    <main class="container">
    {% block content %}
    <div class="container">
        <div class="d-flex align-items-center mb-3">
            <span class="title">
                <span style="color: #000;">Hang</span> <span style="color: #ff0000;">Man</span>
            </span>
        </div>  
    <div class="game-description mb-4">
    <p class="lead text-secondary">
        Teste seu vocabulário com o clássico <strong>Jogo da Forca</strong>!  
        Você receberá uma categoria, como <strong>Animal</strong>, <strong>Profissão</strong> ou <strong>Cidade</strong>, e terá 6 vidas para adivinhar a palavra correta.  
        Cada letra errada custa uma vida, então pense bem antes de tentar!  
        Será que você consegue descobrir a palavra antes que as vidas acabem?
    </p>
    </div>
    <hr>
            <br>
    <div class="container text-center">
        <p><strong>Category:</strong> {{ category }}</p>
    <canvas id="hangmanCanvas" width="300" height="300"></canvas>
    <p class="mt-4 letter">{{ display_word }}</p>
    <p>Guessed letters: {{ guesses|join:", " }}</p>
    {% if message %}
    <div style="margin:1em 0; color: {% if won %}green{% else %}red{% endif %}; font-weight:bold;">{{ message }}</div>
    {% endif %}
    {% if not game_over %}
    <form method="post" class="mb-3">
    {% csrf_token %}
    <input type="text" name="guess" maxlength="1" style="width:40px; text-align:center;" autofocus autocomplete="off" required>
    <button type="submit" class="btn btn-primary btn-sm">Guess</button>
    </form>
    {% else %}
    <a href="?new=1" class="btn btn-success">Play Again</a>
    {% endif %}
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const canvas = document.getElementById('hangmanCanvas');
        const ctx = canvas.getContext('2d');
        const livesLeft = parseInt("{{ lives }}", 10);
        const maxLives = 6; // Assuming 6 lives, adjust if needed

        // Function to draw each part of the hangman
        function drawPart(part) {
            ctx.lineWidth = 4;
            ctx.strokeStyle = '#000';
            ctx.beginPath();
            switch(part) {
                case 1: // Head
                    ctx.arc(150, 80, 20, 0, 2 * Math.PI);
                    break;
                case 2: // Body
                    ctx.moveTo(150, 100);
                    ctx.lineTo(150, 180);
                    break;
                case 3: // Right arm
                    ctx.moveTo(150, 120);
                    ctx.lineTo(180, 150);
                    break;
                case 4: // Left arm
                    ctx.moveTo(150, 120);
                    ctx.lineTo(120, 150);
                    break;
                case 5: // Right leg
                    ctx.moveTo(150, 180);
                    ctx.lineTo(180, 220);
                    break;
                case 6: // Left leg
                    ctx.moveTo(150, 180);
                    ctx.lineTo(120, 220);
                    break;
            }
            ctx.stroke();
        }

        // Function to draw the gallows
        function drawGallows() {
            ctx.lineWidth = 6;
            ctx.strokeStyle = '#6C4A2E'; // Brown color for wood
            ctx.beginPath();
            // Base
            ctx.moveTo(20, 250);
            ctx.lineTo(200, 250);
            // Upright
            ctx.moveTo(50, 250);
            ctx.lineTo(50, 30);
            // Crossbar
            ctx.lineTo(150, 30);
            // Rope
            ctx.lineTo(150, 60);
            ctx.stroke();
        }

        // Main drawing function
        function drawHangman() {
            // Clear the canvas before redrawing
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawGallows();

            // Draw parts based on lives lost
            const partsToDraw = maxLives - livesLeft;
            for (let i = 1; i <= partsToDraw; i++) {
                drawPart(i);
            }
        }

        // Draw the hangman when the page loads
        drawHangman();
    });
</script>
{% endblock %}
    </main>
    {% include "game/footer.html" %}
</body>
</html>
